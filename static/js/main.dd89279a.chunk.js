(this["webpackJsonpprogram-rpg"]=this["webpackJsonpprogram-rpg"]||[]).push([[0],{28:function(e,t,n){},29:function(e,t,n){},41:function(e,t,n){"use strict";n.r(t);var i,r=n(7),o=n.n(r),c=n(22),a=n.n(c),s=(n(28),n(9)),l=n(42),d=(n(29),n(12)),u=n(1),p=n(2),h=n(3),j=n(4),b=n(6),v=n.n(b),x=n(43),m=n(5);!function(e){e[e.A=0]="A",e[e.B=1]="B",e[e.X=2]="X",e[e.Y=3]="Y",e[e.LeftShoulder=4]="LeftShoulder",e[e.RightShoulder=5]="RightShoulder",e[e.LeftTrigger=6]="LeftTrigger",e[e.RightTrigger=7]="RightTrigger",e[e.Back=8]="Back",e[e.Start=9]="Start",e[e.LeftSick=10]="LeftSick",e[e.RightSick=11]="RightSick",e[e.DpadLeft=12]="DpadLeft",e[e.DpadRight=13]="DpadRight",e[e.DpadUp=14]="DpadUp",e[e.DpadDown=15]="DpadDown",e[e.XboxButton=16]="XboxButton"}(i||(i={}));var f=Object.keys(i).filter(v.a.flow(Number,v.a.isNaN)).reduce((function(e,t,n){return Object(d.a)(Object(d.a)({},e),{},Object(m.a)({},n,t))}),{}),O=n(17),g=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.15;return e*e+t*t>n},y=[],w=[],k={keys:{},pointers:{},gamepads:[]},S=0,C=function e(t){for(k.gamepads=Object(O.a)(navigator.getGamepads()).filter(v.a.identity);w.length&&t-w[0].at>1e3;)w.pop();S=window.requestAnimationFrame(e)},I=void 0,R=function(){var e;null===(e=I)||void 0===e||e(),I=void 0},T=function(){if(!I){console.log("Register input listeners");var e=function(e){var t;!1!==(null===(t=k.keys[e.code])||void 0===t?void 0:t.down)&&(k.keys[e.code]={code:e.code,down:!1,at:e.timeStamp},function(e){var t=e.at,n=e.code;y=y.filter((function(e){return e.code===n&&t-e.at<175&&w.push(e),e.code!==n&&t-e.at<175}))}(k.keys[e.code]))},t=function(e){var t,n;!0!==(null===(t=k.keys[e.code])||void 0===t?void 0:t.down)&&(k.keys[e.code]={code:e.code,down:!0,at:e.timeStamp},n=k.keys[e.code],(y=y.filter((function(e){return n.code!==e.code&&n.at-e.at<175}))).push(n))},n=function(e){k.pointers[e.pointerId]={id:e.pointerId,down:!0,x:e.clientX,y:e.clientY,at:e.timeStamp}},i=function(e){k.pointers[e.pointerId]={id:e.pointerId,down:!1,x:e.clientX,y:e.clientY,at:e.timeStamp}},r=function(e){k.pointers[e.pointerId]||(k.pointers[e.pointerId]={id:e.pointerId,down:!1,x:e.clientX,y:e.clientY,at:e.timeStamp}),k.pointers[e.pointerId].x=e.clientX,k.pointers[e.pointerId].y=e.clientY,k.pointers[e.pointerId].at=e.timeStamp};return S=window.requestAnimationFrame(C),window.addEventListener("keyup",e),window.addEventListener("keydown",t),window.addEventListener("pointerdown",n),window.addEventListener("pointerup",i),window.addEventListener("pointermove",r),I=function(){console.log("Unregister input listeners"),window.removeEventListener("keyup",e),window.removeEventListener("keydown",t),window.removeEventListener("pointerdown",n),window.removeEventListener("pointerup",i),window.removeEventListener("pointermove",r),window.cancelAnimationFrame(S),S=-1},R}console.warn("Attempt to re-hook inputs blocked.")},A=n(0),D=function(e){var t=e.x,n=e.y,i=e.radius,r=e.innerRadius,o=void 0===r?i/6:r;return Object(A.jsxs)("svg",{version:"1.1",width:2*i,height:2*i,children:[Object(A.jsx)("circle",{cx:i,cy:i,r:i}),Object(A.jsx)("circle",{cx:i+t*(i-o),cy:i+n*(i-o),r:o,fill:"red"})]})},L=function(e){Object(h.a)(n,e);var t=Object(j.a)(n);function n(e){var i;return Object(u.a)(this,n),(i=t.call(this,e)).state={index:e.gamepad.index,mapping:Object(d.a)({},f)},i}return Object(p.a)(n,[{key:"componentDidUpdate",value:function(e){e.gamepad.index!==this.state.index&&console.warn("Oh no, swapped gamepads!")}},{key:"render",value:function(){var e=this;return Object(A.jsx)("div",{children:this.props.gamepad.buttons.map((function(t,n){return Object(A.jsxs)("div",{children:["(",n,") ",e.state.mapping[n]," ",t.pressed," - ",t.touched," - ",t.value]},n)}))})}}]),n}(o.a.Component),E=function(){return Object(x.a)(1e11),Object(A.jsxs)("div",{className:"text-small",children:[Object(A.jsx)("h3",{children:"Debug Inputs"}),Object(A.jsx)("h4",{children:"Pointers"}),Object(A.jsxs)("table",{children:[Object(A.jsx)("thead",{children:Object(A.jsxs)("tr",{children:[Object(A.jsx)("td",{children:"id"}),Object(A.jsx)("td",{children:"down"}),Object(A.jsx)("td",{children:"x"}),Object(A.jsx)("td",{children:"y"}),Object(A.jsx)("td",{children:"at"})]})}),Object(A.jsx)("tbody",{children:Object.entries(k.pointers).map((function(e){var t=Object(s.a)(e,2),n=t[0],i=t[1];return Object(A.jsxs)("tr",{children:[Object(A.jsx)("td",{children:n}),Object(A.jsx)("td",{children:String(i.down)}),Object(A.jsx)("td",{children:i.x}),Object(A.jsx)("td",{children:i.y}),Object(A.jsx)("td",{children:i.at})]},n)}))})]}),Object(A.jsx)("h4",{children:"Gamepads"}),Object(A.jsxs)("table",{children:[Object(A.jsx)("thead",{children:Object(A.jsxs)("tr",{children:[Object(A.jsx)("td",{children:"id"}),Object(A.jsx)("td",{children:"axes"}),Object(A.jsx)("td",{children:"buttons"}),Object(A.jsx)("td",{children:"connected"}),Object(A.jsx)("td",{children:"mapping"}),Object(A.jsx)("td",{children:"At"})]})}),Object(A.jsx)("tbody",{children:k.gamepads.map((function(e){return Object(A.jsxs)("tr",{children:[Object(A.jsx)("td",{children:e.id}),Object(A.jsx)("td",{children:v.a.chunk(2,e.axes).map((function(e,t){var n=Object(s.a)(e,2),i=n[0],r=n[1];return Object(A.jsx)(D,{x:i,y:r,radius:25},t)}))}),Object(A.jsx)("td",{children:Object(A.jsx)(L,{gamepad:e})}),Object(A.jsx)("td",{children:String(e.connected)}),Object(A.jsx)("td",{children:e.mapping}),Object(A.jsx)("td",{children:e.timestamp})]},e.id)}))})]}),Object(A.jsx)("h4",{children:"Keyboard"}),Object(A.jsxs)("div",{children:["Buffered Keys",Object(A.jsx)("table",{children:Object(A.jsxs)("tbody",{children:[Object(A.jsx)("tr",{children:w.map((function(e){return Object(A.jsx)(r.Fragment,{children:Object(A.jsx)("td",{children:e.code})},e.at)}))}),Object(A.jsx)("tr",{children:w.map((function(e){return Object(A.jsx)(r.Fragment,{children:Object(A.jsx)("td",{children:e.at})},e.at)}))})]})})]}),Object(A.jsxs)("table",{children:[Object(A.jsx)("thead",{children:Object(A.jsxs)("tr",{children:[Object(A.jsx)("td",{children:"Key"}),Object(A.jsx)("td",{children:"Down"}),Object(A.jsx)("td",{children:"At"})]})}),Object(A.jsx)("tbody",{children:Object.entries(k.keys).map((function(e){var t=Object(s.a)(e,2),n=t[0],i=t[1];return Object(A.jsxs)("tr",{children:[Object(A.jsx)("td",{children:n}),Object(A.jsx)("td",{children:String(i.down)}),Object(A.jsx)("td",{children:i.at})]},n)}))})]})]})},B=n(8),M=16711680,F=6881385,N={Up:"KeyW",Down:"KeyS",Left:"KeyA",Right:"KeyD",Spawn:"Space",Boost:"ShiftLeft",CameraUp:"ArrowUp",CameraDown:"ArrowDown",CameraLeft:"ArrowLeft",CameraRight:"ArrowRight",CameraBoost:"ShiftLeft"},P="Other",U="Bullet",V=.1,_=function(e){var t=e.mesh,n=e.name,i=void 0===n?"actor-".concat(Math.random().toString(16).slice(2)):n,r=e.tick,o=void 0===r?v.a.noop:r,c=e.tags,a=void 0===c?new Set:c,s=e.state;return t.name=i,{tick:o,mesh:t,name:i,tags:a,state:s}},z=n(19),X=n(14);var Y=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F;return new B.b(new B.a,new B.c({color:e}))},K=function(e){var t=e.actors,n=e.scene,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=i.mesh,o=void 0===r?Y():r,c=i.x,a=void 0===c?0:c,s=i.y,l=void 0===s?0:s,u=i.tick,p=void 0===u?v.a.noop:u,h=i.state,j=Object(z.a)(i,["mesh","x","y","tick","state"]);o.position.x=a,o.position.y=l,n.add(o);var b=_(Object(d.a)({state:h,mesh:o,tick:p},j));return t.push(b),b},Z=function(e){e.geometry.dispose(),v.a.isArray(e.material)?e.material.forEach((function(e){return e.dispose()})):e.material.dispose()},q=function(e,t){var n,i=v.a.partition((function(e){return t.every((function(t){return e.tags.has(t)}))}),e.actors),r=Object(s.a)(i,2),o=r[0],c=r[1];e.actors=c,(n=e.scene).remove.apply(n,Object(O.a)(o.map((function(e){return e.mesh})))),o.forEach((function(e){var t=e.mesh;return Z(t)}))},G=function(e,t){var n,i=new Set(t);e.actors=e.actors.filter((function(e){return!i.has(e)})),(n=e.scene).remove.apply(n,Object(O.a)(t.map((function(e){return e.mesh})))),t.forEach((function(e){return Z(e.mesh)}))},W=function(e,t){return G(e,[t])},J=function(e,t){var n=v.a.isArray(t)?new Set(t):t;return e.actors.filter((function(e){return function(e,t){var n,i=v.a.sortBy("size",[e,t]),r=Object(s.a)(i,2),o=r[0],c=r[1],a=Object(X.a)(o);try{for(a.s();!(n=a.n()).done;){var l=n.value;if(c.has(l))return!0}}catch(d){a.e(d)}finally{a.f()}return!1}(e.tags,n)}))},H=(n(38),n(39),n(40),n(18)),Q=n.n(H),$={Vector3:B.j,Spherical:B.i},ee=function(e){return e($)},te=function(e){var t=new Function('"use strict";return ({ Vector3, Spherical }) => { '.concat(e," }"))();return ee(t),{source:e,fn:t}},ne=[te("return (delta, position, velocity) => {\n  position.addScaledVector(velocity, delta);\n};"),te("let theta = 0;\nconst up = new Vector3(0.0, 0.0, 1.0);\nreturn (delta, position, velocity) => {\n  position.addScaledVector(velocity, delta);\n  velocity.applyAxisAngle(up, theta);\n  theta += 0.0001;\n};"),te("const up = new Vector3(0.0, 0.0, 1.0);\nconst theta = Math.random() * Math.PI * 2;\nconst fixedVelocity = new Vector3(1.0, 1.0, 0.0)\n\t.applyAxisAngle(up, theta)\n\t.normalize()\n\t.multiplyScalar(0.03);\n\nreturn (delta, position, velocity) => {\n\tposition.addScaledVector(fixedVelocity, delta);\n};")],ie=function(e){Object(h.a)(n,e);var t=Object(j.a)(n);function n(e){var i;return Object(u.a)(this,n),(i=t.call(this,e)).containerRef=void 0,i.codeMirror=void 0,i.dispose=v.a.noop,i.containerRef=Object(r.createRef)(),i}return Object(p.a)(n,[{key:"componentDidMount",value:function(){var e=this;if(this.containerRef.current){var t,n=function(t){e.props.onChange(t.doc.getValue())},i=function(){return e.props.onFocus()},r=function(){return e.props.onBlur()};this.codeMirror=new Q.a(this.containerRef.current,{lineNumbers:!0,matchBrackets:!0,mode:"text/typescript",value:null!==(t=this.props.source)&&void 0!==t?t:""}),this.codeMirror.on("change",n),this.codeMirror.on("focus",i),this.codeMirror.on("blur",r),this.dispose=v.a.once((function(){e.codeMirror.off("change",n),e.codeMirror.off("focus",i),e.codeMirror.off("blur",r)}))}}},{key:"componentWillUnmount",value:function(){this.dispose()}},{key:"componentDidUpdate",value:function(e){this.props.source!==e.source&&this.codeMirror.setValue(this.props.source)}},{key:"render",value:function(){return Object(A.jsx)("div",{ref:this.containerRef})}}]),n}(o.a.Component),re=function(e){var t,n,i=e.input;return Object(A.jsx)("div",{className:"text-small",children:Object(A.jsxs)("table",{children:[Object(A.jsxs)("colgroup",{children:[Object(A.jsx)("col",{width:"40%"}),Object(A.jsx)("col",{width:"30%"}),Object(A.jsx)("col",{width:"35%"})]}),Object(A.jsxs)("tbody",{children:[Object(A.jsxs)("tr",{children:[Object(A.jsx)("td",{children:"Mouse"}),Object(A.jsx)("td",{colSpan:2,children:(null===(t=i.globalInputs.pointers)||void 0===t||null===(n=t[0])||void 0===n?void 0:n.down)?"down":"up"})]}),Object(A.jsxs)("tr",{children:[Object(A.jsx)("td",{}),Object(A.jsx)("td",{children:i.mouse.x.toPrecision(4)}),Object(A.jsx)("td",{children:i.mouse.y.toPrecision(4)})]}),Object.keys(N).map((function(e){return Object(A.jsxs)("tr",{children:[Object(A.jsx)("td",{children:e}),Object(A.jsx)("td",{children:N[e]}),Object(A.jsx)("td",{children:i.globalInputs.keys[N[e]]?"down":"up"})]},e)}))]})]})})},oe=function(e){var t=e.target;return Object(A.jsxs)("div",{className:"text-small",children:["Target: ",t.name]})},ce=function(e){var t,n=e.input,i=e.targets,o=void 0===i?[]:i,c=e.spell,a=e.onSpellChange,l=void 0===a?v.a.noop:a,d=e.onFocus,u=void 0===d?v.a.noop:d,p=e.onBlur,h=void 0===p?v.a.noop:p,j=Object(r.useState)(null!==(t=null===c||void 0===c?void 0:c.source)&&void 0!==t?t:""),b=Object(s.a)(j,2),x=b[0],m=b[1],f=Object(r.useState)(),O=Object(s.a)(f,2),g=O[0],y=O[1],w=Object(r.useState)(c),k=Object(s.a)(w,2),S=k[0],C=k[1];Object(r.useEffect)((function(){(null===c||void 0===c?void 0:c.source)&&c.source!==x&&(m(c.source),C(c))}),[x,c,C]);var I=Object(r.useCallback)((function(e){try{var t=te(e);C(t),y(void 0)}catch(g){C(void 0),y(g)}}),[]);return Object(A.jsxs)("div",{className:"flex-column flex-expand no-scroll",children:[Object(A.jsx)("h4",{children:"Spells"}),Object(A.jsxs)("div",{className:"error-bar text-small flex-row flex-middle",children:[g&&String(g),"\xa0"]}),Object(A.jsx)("button",{disabled:g,onClick:function(){S&&l(S)},children:"Update"}),Object(A.jsx)(ie,{source:x,onChange:I,onFocus:u,onBlur:h}),Object(A.jsxs)("div",{className:"flex-row flex-expand no-scroll",children:[Object(A.jsx)("div",{className:"flex-expand scroll",children:n?Object(A.jsx)(re,{input:n}):null}),Object(A.jsxs)("div",{className:"flex-expand",children:[o.length<=0&&"Nothing under mouse",o.map((function(e,t){return Object(A.jsx)(oe,{target:e.object},t)}))]})]})]})},ae=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e.clone().add((new B.j).setFromSphericalCoords(Math.random()*(t-n)+n,Math.random()*Math.PI*2,Math.PI/2).setZ(0))};function se(e,t){var n,i=Object(X.a)(t);try{for(i.s();!(n=i.n()).done;){var r=n.value;e.add(r)}}catch(o){i.e(o)}finally{i.f()}return e}var le=function(){return function(e,t,n){var i=t.delta,r=n.mesh;r.rotation.x+=.01,r.rotation.y+=.01;if(e.bb.player&&r.position.distanceTo(e.bb.player.mesh.position)>.05){var o=e.bb.player.mesh.position.clone().sub(r.position).normalize().multiplyScalar(.05*V*i);r.position.add(o)}}},de=function(e){var t,n,i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=v.a.has(["x","y"],r)?v.a.pick(["x","y"],r):ae(null!==(t=null===(n=e.ctx.bb.player)||void 0===n||null===(i=n.mesh)||void 0===i?void 0:i.position)&&void 0!==t?t:new B.j,10,2),c=r.tags,a=void 0===c?new Set:c,s=r.tick,l=void 0===s?le():s,u=Object(z.a)(r,["tags","tick"]);e.makeEntity(Object(d.a)({tags:se(new Set([P]),a),x:o.x,y:o.y,mesh:Y(M),name:"some-enemy",tick:l},u))},ue=function(){var e,t=new B.j(1,0,0);return function(n,i,r){var o=i.delta,c=r.mesh;(!e||e.distanceTo(c.position)<=.02)&&(e=ae(c.position,3,1)),t.copy(e).setZ(0).sub(c.position).normalize().setZ(0),c.lookAt(e),c.position.add(t.multiplyScalar(.002*o))}},pe=function(e){Object(h.a)(n,e);var t=Object(j.a)(n);function n(e){var i;Object(u.a)(this,n),(i=t.call(this,e)).containerRef=void 0,i.api=void 0,i.tickables=[],i._time=0,i._frameId=0;var o=function(e){var t=e.renderer,n=e.camera,i=e.scene,r=e.actors,o=void 0===r?[]:r,c=e.bb,a=void 0===c?{input:{globalInputs:k,mouse:{x:0,y:0}}}:c,s=e.targets;return{renderer:t,actors:o,camera:n,scene:i,bb:a,targets:void 0===s?[]:s}}({scene:new B.g,camera:new B.d(35,1,.1,1e3),renderer:new B.k});return i.containerRef=Object(r.createRef)(),o.renderer.setSize(480,480),o.camera.position.z=30,i.api=function(e){return{ctx:e,raycaster:new B.f,makeEntity:v.a.partial(K,[e]),remove:v.a.partial(W,[e]),removeAll:v.a.partial(G,[e]),removeByTags:v.a.partial(q,[e]),getByTags:v.a.partial(J,[e])}}(o),i.state={api:i.api,paused:!0,spellSaved:0,currentSpell:void 0,currentSpellTicker:void 0},i}return Object(p.a)(n,[{key:"componentDidMount",value:function(){var e;null===(e=this.containerRef.current)||void 0===e||e.appendChild(this.api.ctx.renderer.domElement),function(e){var t=e.makeEntity({x:1,y:1,name:"cube",tick:function(e,t,n){var i,r,o,c,a,l,d,u=t.delta,p=n.mesh;p.rotation.x+=.01,p.rotation.y+=.01;var h=e.bb.input.globalInputs,j=new B.j,b=.12*((null===(i=h.keys[N.Boost])||void 0===i?void 0:i.down)?2:1);if((null===(r=h.keys[N.Up])||void 0===r?void 0:r.down)&&j.y++,(null===(o=h.keys[N.Down])||void 0===o?void 0:o.down)&&j.y--,(null===(c=h.keys[N.Left])||void 0===c?void 0:c.down)&&j.x--,(null===(a=h.keys[N.Right])||void 0===a?void 0:a.down)&&j.x++,null===(l=h.gamepads)||void 0===l||null===(d=l[0])||void 0===d?void 0:d.axes){var v,x,m=null===(v=h.gamepads)||void 0===v||null===(x=v[0])||void 0===x?void 0:x.axes,f=Object(s.a)(m,2),O=f[0],y=f[1];g(O,+y)&&(j.x=O,j.y=-y)}p.position.add(j.normalize().multiplyScalar(b*V*u))}});de(e),e.ctx.bb.player=t;var n=new B.b(new B.e(1e4,1e4),new B.h({uniforms:{},vertexShader:"varying vec2 vUv;\n\nvoid main()\n{\n\tvUv = uv;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n}",fragmentShader:"varying vec2 vUv;\n\n// rg gradient\nvec4 simple_gradient(vec2 position, vec2 gridcell) {\n\treturn vec4(\n\t\tposition.yx * 100.0,\n\t\t1.0,\n\t\t1.0\n\t);\n}\n\n\nvec4 ground(vec2 position, vec2 gridcell) {\n\treturn vec4(gridcell.xy, 1.0, 1.0);\n}\n\n\n// Simple grid overlay combine\nvoid main( void ) {\n\tvec2 position = - 1.0 + 2.0 * vUv;\n\tvec2 gridcell = mod(floor(position.xy * 100000.0), 80.0) / 80.0;\n\tvec4 color = simple_gradient(position, gridcell);\n\n\tif (gridcell.x == 0.0 || gridcell.y == 0.0) {\n\t\tgl_FragColor = -color;\n\t} else {\n\t\tgl_FragColor = color;\n\t}\n}"}));n.position.z=-2,n.name="ground",e.ctx.scene.add(n);var i=new B.b(new B.e(1e6,1e6),new B.c({opacity:0,transparent:!0}));i.name="targeting",e.ctx.scene.add(i)}(this.api),this.tickables.push(function(){var e=Date.now();return function(t){var n;(null===(n=t.ctx.bb.input.globalInputs.keys[N.Spawn])||void 0===n?void 0:n.down)&&Date.now()-e>=250&&(e=Date.now(),de(t))}}()),this.tickables.push(function(e){var t=e.api,n=e.maxPop,i=void 0===n?10:n,r=e.spawnTime,o=void 0===r?1500:r;console.log("Make Spawner",{api:t,maxPop:i});var c=t.makeEntity({}),a=0,s=new Set(["spawner",c.mesh.uuid]);return function(e,t){var n=e.getByTags(s);if(t.time-a>=o&&n.length<i){var r=ae(c.mesh.position,15,3),l=r.x,d=r.y;de(e,{x:l,y:d,tags:s,tick:ue()}),a=t.time}}}({api:this.api})),this.tickables.push((function(e){var t;if(null===(t=e.ctx.bb.player)||void 0===t?void 0:t.mesh.position){var n=e.ctx.bb.player.mesh.position.clone().setZ(e.ctx.camera.position.z);e.ctx.camera.position.distanceTo(n)<.1?e.ctx.camera.position.copy(n):e.ctx.camera.position.lerp(n,.1)}})),this.setSpell(ne[0]),this.play()}},{key:"componentWillUnmount",value:function(){this.pause()}},{key:"play",value:function(){var e=this;this.state.paused&&(this._time=performance.now(),this._frameId=window.requestAnimationFrame((function(t){return e.tick(t)})),this.setState({paused:!1}))}},{key:"pause",value:function(){this.state.paused||(window.cancelAnimationFrame(this._frameId),this._frameId=-1,this.setState({paused:!0}))}},{key:"tick",value:function(e){var t=this;if(!this.state.paused){this._frameId=window.requestAnimationFrame((function(e){return t.tick(e)}));var n={time:e,delta:e-this._time};if(this._time=e,this.api.ctx.bb.input.globalInputs.pointers[1]){var i=this.api.ctx.renderer.domElement.getBoundingClientRect(),r=i.x,o=i.y,c=i.width,a=i.height,s=this.api.ctx.bb.input.globalInputs.pointers[1],l=s.x,d=s.y;this.api.ctx.bb.input.mouse.x=(l-c/2-r)/c*2,this.api.ctx.bb.input.mouse.y=-(d-a/2-o)/a*2}this.api.raycaster.setFromCamera(this.api.ctx.bb.input.mouse,this.api.ctx.camera),this.api.ctx.targets=this.api.raycaster.intersectObjects(this.api.ctx.scene.children),this.api.ctx.targeting=this.api.ctx.targets.find((function(e){return"targeting"===e.object.name})),this.tickables.forEach((function(e){return e(t.api,n)})),this.api.ctx.actors.forEach((function(e){return e.tick(t.api.ctx,n,e)})),this.api.ctx.renderer.render(this.api.ctx.scene,this.api.ctx.camera),this.setState({api:this.api})}}},{key:"render",value:function(){var e=this;return Object(A.jsx)("div",{className:"flex-expand",children:Object(A.jsxs)("div",{className:"fill flex-row padded",children:[Object(A.jsxs)("div",{className:"flex-column flex-expand",children:[Object(A.jsxs)("div",{ref:this.containerRef,children:[this.state.paused&&Object(A.jsx)("div",{className:"fill pause-overlay",children:Object(A.jsx)("h3",{children:"Paused"})}),Object(A.jsx)("div",{className:"fill spell-saved-overlay",style:{opacity:Boolean(this.state.spellSaved)?1:0},children:Object(A.jsx)("h3",{children:"Spell Saved"})})]}),Object(A.jsxs)("div",{className:"flex-row",children:[Object(A.jsx)("button",{disabled:!this.api.ctx.bb.player,onClick:function(t){t.currentTarget.blur(),e.api.ctx.bb.player&&(e.api.ctx.camera.position.setX(e.api.ctx.bb.player.mesh.position.x),e.api.ctx.camera.position.setY(e.api.ctx.bb.player.mesh.position.y))},children:"Center Player"}),Object(A.jsx)("button",{onClick:function(t){t.currentTarget.blur(),e.api.removeByTags([P])},children:"Clear Other"}),Object(A.jsx)("button",{className:this.state.paused?"pause-btn--paused":"pause-btn--playing",onClick:function(t){t.currentTarget.blur(),e.state.paused?e.play():e.pause()},children:this.state.paused?"Resume":"Pause"}),Object(A.jsx)("button",{onClick:function(){var t;return e.setSpell(null!==(t=v.a.sample(ne))&&void 0!==t?t:ne[0])},children:"Random Spell"}),Object(A.jsxs)("select",{value:-1,onChange:function(t){t.currentTarget.blur();var n=ne[t.target.value];n&&e.setSpell(n)},children:[Object(A.jsx)("option",{value:-1,children:"Spellbook"}),ne.map((function(e,t){return Object(A.jsxs)("option",{value:t,children:["Spell ",t]},t)}))]})]})]}),Object(A.jsx)(ce,{input:this.api.ctx.bb.input,targets:this.api.ctx.targets,spell:this.state.currentSpell,onFocus:function(){e.state.paused||e.pause()},onSpellChange:function(t){e.setSpell(t)}})]})})}},{key:"setSpell",value:function(e){var t=this;this.state.currentSpellTicker&&(this.tickables=this.tickables.filter((function(e){return e!==t.state.currentSpellTicker})));var n=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ne[0],t=100,n=0;return function(i,r){var o,c,a,l,d,u,p=r.time,h=null!==(o=null===(c=i.ctx.bb.input.globalInputs.gamepads)||void 0===c||null===(a=c[0])||void 0===a||null===(l=a.axes)||void 0===l?void 0:l.slice(2))&&void 0!==o?o:[0,0],j=Object(s.a)(h,2),b=j[0],v=j[1],x=g(b,v);if(i.ctx.targeting&&i.ctx.bb.player&&((null===(d=i.ctx.bb.input.globalInputs.pointers)||void 0===d||null===(u=d[1])||void 0===u?void 0:u.down)||x)&&p-n>=t){n=p;var m=ee(e.fn),f=function(){if(x)return new B.j(b,-v);var e=i.ctx.targeting.point.clone().setZ(0),t=i.ctx.bb.player.mesh.position.clone().setZ(0);return e.sub(t)}();f.normalize().multiplyScalar(.05*V),i.makeEntity({x:i.ctx.bb.player.mesh.position.x,y:i.ctx.bb.player.mesh.position.y,state:{velocity:f,life:500},mesh:new B.b(new B.a(.1,.1,.1),new B.c({color:M})),tags:new Set([U]),tick:function(e,t,n){var r=t.delta,o=n.mesh,c=n.state;if(c.life<=1)i.remove(n);else{c.life--;try{m(r,o.position,c.velocity);var a=i.ctx.actors.find((function(e){return e.tags.has(P)&&e.mesh.position.distanceTo(o.position)<=.8}));a&&i.removeAll([a,n])}catch(s){console.warn("Spell Exception",s),c.life=0}}}})}}}(e);this.tickables.push(n),this.state.spellSaved&&clearTimeout(this.state.spellSaved);var i=+setTimeout((function(){t.setState({spellSaved:0})}),2e3);this.setState({spellSaved:i,currentSpell:e,currentSpellTicker:n})}}]),n}(o.a.Component),he=function(){return Object(A.jsxs)("div",{children:[Object(A.jsx)("h4",{children:"Program RPG"}),Object(A.jsx)("p",{children:"A little playground of an idea. Spells and weapons are backed by scripts. You can modify these scripts at the cost of MP per compute."}),Object(A.jsxs)("p",{children:["See ",Object(A.jsx)("a",{href:"https://threejs.org/docs/index.html#api/en/math/Vector3",children:"three.js / Vector3"})," for docs on spell's position/velocity types."]})]})};var je=function(){var e=Object(r.useState)(!1),t=Object(s.a)(e,2),n=t[0],i=t[1];return Object(l.a)(T,R),Object(A.jsxs)("div",{className:"flex-column padded fill",children:[Object(A.jsx)(he,{}),Object(A.jsx)("div",{children:Object(A.jsx)("button",{onClick:function(){return i(!n)},children:"Toggle Input Debug"})}),n&&Object(A.jsx)(E,{}),Object(A.jsx)(pe,{})]})},be=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,44)).then((function(t){var n=t.getCLS,i=t.getFID,r=t.getFCP,o=t.getLCP,c=t.getTTFB;n(e),i(e),r(e),o(e),c(e)}))};a.a.render(Object(A.jsx)(o.a.StrictMode,{children:Object(A.jsx)(je,{})}),document.getElementById("root")),be()}},[[41,1,2]]]);
//# sourceMappingURL=main.dd89279a.chunk.js.map